# 研究課題4.8  
## 課題内容  
**ディレクトリに対するリンク** linkを使ってディレクトリに新しいリンクを張ることを認められているユーザーはいない。  
しかし、古い時代のUnixには、スーパーユーザーはディレクトリにハードリンクを作ることが認められていた。  
demodirサンプルにおいて、ユーザーの視点、システムの視点の両方にlink("demodir/c" , "demodir/d2/e")というシステムコールが及ぼす影響を書き込みなさい。  
次に、ls -aR demodirの動作がどのようになるのかを説明しなさい。  
  
## demodirの構成を確認する  
  
tree demodirでディレクトリ構成を確認した。以下のようになっている。  
  
  
demodir  
├── a  
│   └── x  
├── c  
│   ├── d1  
│   │   └── xlink  
│   └── d2  
│       └── xcopy  
├── test.sh  
└── y  
  
demodir , a , c , d1 , d2 はディレクトリである。  
  
## link("demodir/c","demodir/d2/e")は何をするのか？  
demodir/cへのリンク、demodir/d2/eを作るということになる。  
ユーザーの視点からは、d2ディレクトリの中にeディレクトリを作ったら、その中身はcというような見た目になる。  
システムからの視点では、d2ディレクトリの中にcと指しているinodeが同じeというディレクトリエントリが作成されることになる。  
cのinodeのリンクカウントが１増加する。  
  
## ls -aRの動作  
これは、この新しくdemodir/cに対するハードリンクがその子や孫ディレクトリ内にある場合、危険な操作になる。eディレクトリの先にcディレクトリがあり、cディレクトリの中にd2/eがあるため、循環参照になってしまうためだ。  
ls -aR等を行った場合、この再帰的処理のベースケースの条件である（ディレクトリの中にディレクトリがない場合）という条件に到達することがなくなるのでディレクトリの探索が終了しなくなる。（循環しているためディレクトリがないディレクトリに到達できない）。ユーザーが強制終了しない限り、ずっとディレクトリを探索し続けてしまう。  
  
現在のunixでは、ディレクトリのハードリンクを作れないのはこれが理由と思われる。  
  
  
  
  
  

# 研究課題5.04
## 課題内容
**rmとスペシャルファイル** rmコマンドとその基礎となっているunlinkシステムコールは、iノードへのリンクを切断する。
inodeに対するリンク数が0になると、カーネルはディスクブロックとinodeを解放する。
しかし、デバイスのiノードは割当リストを持たず、データブロックを持たない。
代わりに、デバイスファイルのinodeはカーネル内のデバイスドライバサブルーチンを指すポインタを含んでいる。
デバイスのファイル名を削除し、カーネルがinodeを開放しても、ドライバはカーネルの中に残っている。
では、そのデバイスに接続する新しいファイルを作成するにはどうしたらよいか(ヒント:mknodについて調べなさい)

## mknodについて調べる
mknodは２つある。mknodコマンドとmknodシステムコールだ。
mknodコマンドは内部的にmknod2システムコールを使ってノードを作成しているだけなので、
mknodコマンドで調査する。

### mknod(1)コマンド
ブロックかキャラクターのスペシャルファイルを作成する。

- 書式
mknod [option] ... NAME TYPE [MAJOR MINOR]

スペシャルファイルの作成はこちらのコマンドで可能なようだ。

実際にやった操作は以下のようになる。


```
$ sudo mknod spfile c 136 1
$ sudo cat spfile
cat: spfile: 入力/出力エラーです

```
入力出力エラーが出る。
では /dev/pts/以下にファイルを作ったらどうなるのか？

```
$ sudo mknod /dev/pts/spfile c 136 1
mknod: /dev/pts/spfile: 許可されていない操作です
```

/dev/pts/フォルダ下にmknodでスペシャルファイルを作るのはユーザーには禁止されている操作のようだ。端末のファイルシステムに関してはカーネルが行う操作なのだろう。
/dev/input/フォルダ以下でマウスデバイスのインプットに対して以上と同様の操作を行ったら、問題なく動いた。

```
$ sudo mknod mycharmice c 13 63
$ ls
5.04.md  mknod  mknod1.c  mycharmice
$ sudo cat mycharmice
8��
	
     �$

```

問題なく動かすことができた。

### 端末はなぜ動かなかったのか？
端末に関するスペシャルファイルはdevptsという仮想ファイルシステムの上で動いている。
linuxの仕様上 /dev/pts/以下はカーネル側の管理となっておりユーザーからは操作することができないようになっている。

/dev/input/以下はdevtmpfsという仮想ファイルシステムで管理されているが、上記のような制約がないため
普通にキャラクタデバイスファイルなどもどこにでも作成して動くし、あらたなキャラクタデバイスファイルを/dev/input/以下に作成することも許可されている。

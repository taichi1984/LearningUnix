# プログラミング課題 7.8
## 課題内容
**テキストの点滅表示** Webブラウザの中には、テキストの点滅表示や電光ニュース機能をサポートするものがある。
点滅するメッセージを表示するように、hello.cを書き換えなさい。ユーザーがコマンド行でメッセージを指定した場合には、
そのメッセージを表示し、そうでなければデフォルトのメッセージを表示するようにしなさい。
sleep関数を使ってメッセージを表示してから消去するまで間を置くようにしなさい。

## 設計案
点滅の方法はインターバルタイマを使って、表示のオンオフフラグを管理。
表示オフなら文字列表示、表示オンなら文字列を消去する。
メインループはシグナルがくるまでpauseしつつ、シグナルがきたら表示処理を行う。

文字はデフォルトでhello world
引数があった場合はその引数にする。
文字を消すためのBlankは表示するメッセージ分のスペースで埋められた文字列を用意して削除に使う。

sleepとsetitimerを同時に使うと、競合が発生して予期しない動作になるため、
点滅タイミングを調整したい場合は、表示したタイミングと削除したタイミングでsetitimerをセットし直す関数であるset_ticker()を呼んで再設定する。

## プログラム
```
/* hello1.c
 * 目的: cursesを使うために必要な最小限の呼び出しを示す。
 *       インターバルタイマを使って、表示を点滅させる。
 * 概要: 初期化、描画、入力待ち、終了
 */

#include <curses.h>
#include <signal.h>
#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include <sys/time.h>
#include <unistd.h>

int visible = 0;
int set_ticker(int);
void check_visible();

int main(int ac, char *av[]) {

  char *message;
  size_t len;

  if (ac == 1) {
    message = "Hello world";
  } else if (ac == 2) {
    message = av[1];
  } else {
    fprintf(stderr, "引数が正しくありません\n");
    exit(2);
  }

  len = strlen(message);
  char blank[len + 1];
  memset(blank, ' ', len);
  blank[len] = '\0';

  initscr();
  curs_set(0);
  clear();
  signal(SIGALRM, check_visible);

  set_ticker(100);
  while (1) {
    pause();
    if (visible == 0) {
      move(10, 20);
      addstr(message);
      set_ticker(2000); // 点滅の速さを調整。一定速度で点滅させたい場合は
                        // if(visible == 0)のset_ticker(300)と一緒に削除する。
    } else {
      move(10, 20);
      addstr(blank);
      set_ticker(300); // 点滅の速さを調整。一定速度で点滅させたい場合は
                       // if(visible == 0)のset_ticker(2000)と一緒に削除する。
    }

    refresh();
  }

  endwin();
}

int set_ticker(int n_msecs) {
  struct itimerval new_timeset;
  long n_sec, n_usecs;

  n_sec = n_msecs / 1000;
  n_usecs = (n_msecs % 1000) * 1000L;

  new_timeset.it_interval.tv_sec = n_sec;
  new_timeset.it_interval.tv_usec = n_usecs;

  new_timeset.it_value.tv_sec = n_sec;
  new_timeset.it_value.tv_usec = n_usecs;

  return setitimer(ITIMER_REAL, &new_timeset, NULL);
}

void check_visible() {
  if (visible == 0) {
    visible = 1;
  } else {
    visible = 0;
  }
}

```

## 実行結果
期待通りの動作が確認できた。
sleepを使う方法が実際にあるのかは不明な状況。



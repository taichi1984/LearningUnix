# 研究課題6.02
## 課題内容
**他のファイルのノンブロッキング入力** O_NDELAYは、端末ドライバだけではなく、
あらゆるファイルディスクリプタが持つ属性である。つまり、この属性は、デバイスファイルだけでなく、
ディスクファイルにも適用できるということである。
ディスクファイルにとってノンブロッキング入力とはどのような意味か。
端末以外のデバイスにとって、ノンブロッキング入力はどのような意味を持つか。

## ディスクファイルで試してみた

実際の今動いているディスクファイルにいきなり操作を加えるのは危険なため
以下の操作でdisk.imgというイメージファイルとそのAPIである/dev/loop23を用意し実験を行った。

```
$ dd if=/dev/zero of=disk.img bs=1M count=16
16+0 records in
16+0 records out
16777216 bytes (17 MB, 16 MiB) copied, 0.0103243 s, 1.6 GB/s
$ ls
disk.img
$ sudo losetup --find --show disk.img
/dev/loop23

```

###プログラムコード

```
#include <fcntl.h>
#include <stdio.h>
#include <stdlib.h>
#include <unistd.h>

int main(void) {
  int fd;
  fd = open("/dev/loop23", O_RDWR | O_NDELAY); //この行にO_NDELAYをつけたりつけなかったりする。
  if (fd == -1) {
    perror("open");
    exit(1);
  }

  write(fd, "testdata\n", sizeof("testdata"));

  close(fd);
}
```

ディスクファイルにこの操作を行った結果以下のように動作した。

```
$ sudo ./adddata
$ sudo cat /dev/loop23
testdata
```

普通にO_NDELAYを行っても通常と変わりなくwriteシステムコールの動作が行われた。
ディスクファイルにO_NDELAYなどを行っても特に動作は変わらないようだ。
端末以外のデバイスにとってノンブロッキング入力は特に意味を持たないと思われる。
ブロックが発生する余地がない対象にはO_NDELAYの効果は出ない。（そもそもブロックされないので）

## 端末以外のデバイスでO_NDELAYが効くものはあるのか？
FIFO
ソケット
パイプ

などの端末はO_NDELAYが効くようだ。
現状ではまだこれらのものに触れていないので詳細についてはのちの課題でやっていくことになるだろう。



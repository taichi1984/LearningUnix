# プログラミング課題8.8
## 課題内容
**2つの子を待つ** 親プロセスが２つの子プロセスを作り、両方の子がexitを呼び出すのを待つように、waitdemo1.cを拡張しなさい。
さらに、コマンド行引数として、整数値を受け付けるように解答を拡張しなさい。
プログラムは、指定された個数の子プロセスを作り、個々の子プロセスにランダムな秒数を割り当てて眠らせるものとする。最後に、親プロセスは個々の子プロセスがexitを呼び出して終了したことを報告するようにしなさい。

## プログラムコード
```

/* waitdemo1.c - 子プロセスが終了するまで親が１時停止する様子を示す 
*   子はランダムな秒数sleepしexit。親はそれを受けステータスつきで子が終了したことを通知する。
*/
#define _GNU_SOURCE

#include <stdio.h>
#include <stdlib.h>
#include <sys/wait.h>
#include <time.h>
#include <unistd.h>

int main(int ac, char *av[]) {
  srand(time(NULL));
  if (ac != 2) {
    fprintf(stderr, "引数の数が違います。");
    exit(1);
  }

  int proc_num = atoi(av[1]);
  int newpid_list[proc_num];
  void child_code(int), parent_code(int);

  printf("before: mypid is %d\n", getpid());

  for (int i = 0; i < proc_num; i++) {
    int delay = rand() % 10 + 1;
    if ((newpid_list[i] = fork()) == -1)
      perror("fork");
    else if (newpid_list[i] == 0)
      child_code(delay);
  }

  for (int i = 0; i < proc_num; i++) {
    if (newpid_list[i] != 0) {
      parent_code(newpid_list[i]);
    }
  }
}

/*
 *  新プロセスは居眠りをして終了する。
 */

void child_code(int delay) {
  printf(" child %d here. will sleep for %d seconds \n", getpid(), delay);
  sleep(delay);
  printf("child done. about to exit\n");
  exit(17);
}

/*
 * 親は子が終了するのを待ってからメッセージを出力する
 */

void parent_code(int childpid) {
  int wait_rv;
  int wstatus;
  wait_rv = waitpid(childpid, &wstatus, 0);
  printf("mypid is %d . done wating for %d. Wait returned: %d\n", getpid(),
         childpid, wait_rv);
  printf("status exit is %d, sig = %d , core = %d\n", WEXITSTATUS(wstatus),
         WTERMSIG(wstatus), WCOREDUMP(wstatus));
}

```

## 実行結果

```
$ ./waitdemo1 3
before: mypid is 9647
 child 9648 here. will sleep for 2 seconds 
 child 9649 here. will sleep for 6 seconds 
 child 9650 here. will sleep for 7 seconds 
child done. about to exit
mypid is 9647 . done wating for 9648. Wait returned: 9648
status exit is 17, sig = 0 , core = 0
child done. about to exit
mypid is 9647 . done wating for 9649. Wait returned: 9649
status exit is 17, sig = 0 , core = 0
child done. about to exit
mypid is 9647 . done wating for 9650. Wait returned: 9650
status exit is 17, sig = 0 , core = 0
```

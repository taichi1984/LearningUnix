# プログラミング課題6.10
## 課題内容
割り込みはいつも破壊的な意味を持つわけではない。数日かかるプロジェクトに取り組んでいるときに、
上司から電話がかかってきて、進行状況を尋ねられたとする。
これは、プロセスを強制終了するための割り込みではなく、ステータスレポート:status report（状態の報告)サブルーチンを実行するための割り込みである。
時間のかかる仕事をするCプログラムを書きなさい。例えば、遅いアルゴリズムで素数を探すプログラムなどが良い。
プログラムは、それまで見つけた最大の素数を管理する。
さらに、このプログラムにチェックした数値の個数とそれまでに見つかった最大の素数を示す簡単なレポートを出力する
SIGINTハンドラを追加しなさい。
このアイデアは、システムプログラムでどのように活用することができるか、考えて説明しなさい。

## プログラムを書く

```
#include <signal.h>
#include <stdio.h>
#include <stdlib.h>

static int max_primenumber = 0;
static int check_number = 0;
void show_report(int signum);

int main(void) {
  void show_report(int signum);

  int num;
  signal(SIGINT, show_report);

  printf("入力された数値までの素数を求めます\n");
  scanf("%d", &num);
  for (int i = 2; i <= num; i++) {
    printf("%dを検証します : ", i);
    check_number = i;
    for (int j = 2; j <= i; j++) {
      if (i == j) {
        printf("%dは素数です\n", i);
        max_primenumber = i;
      }
      if (i % j == 0) {
        break;
      }
    }
    printf("\n");
  }
}

void show_report(int signum) {
  int c;
  printf("\n現在判明している最大の素数は %d です。\n", max_primenumber);
  printf("現在%dまで検証しています。\n", check_number);

  printf("続行しますか？ (y/n)\n");

  do {
    c = getchar();
  } while (c == '\n');

  if (c == 'y' || c == 'Y') {
    printf("続行します\n");
  } else {
    printf("処理を終了します\n");
    exit(2);
  }
}
```

### 実行結果
```
~~~~略~~~~

45957を検証します : 
45958を検証します : 
45959を検証します : 45959は素数です

45960を検証します : 
45961を検証します : 
45962を検証します : 
45963を検証します : 
45964を検証します : 
45965を検証します : 
45966を検証します : 
45967を検証します : 
45968を検証します : 
45969を検証します : 
45970を検証します : 
^C45971を検証します : 
現在判明している最大の素数は 45959 です。
現在45971まで検証しています。
続行しますか？ (y/n)
n
処理を終了します

```

このようにレポートされるようになった。
yを入力すると続行するのも確認済み。

## システムプログラムではどのように活用することができるか？
プロセス間で通信を行う場合、特定のシグナルを相手のプロセスを指定して送ることにより、
特定の処理をしてほしいというような要求を行うことができるのは想定される。

また、プロセスを他のプロセスから終了するようにSIGTERMなどが送られたときに
終了する前にログや復旧用の一時ファイルを残すようにするなどの、処置も考えられる。
いろいろなことができそうだ。



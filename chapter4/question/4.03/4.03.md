# 研究課題4.3
## 課題内容
Unixは、配列としてのディスクという抽象を内部的に使ってファイルシステムを構築するだけではなく、
適切なパーミッションを持つユーザーがこの抽象を使えるようにもしている。
このプロジェクトの溜めには、ルートアクセスが必要だ。
/dev ディレクトリは、ディスク上のブロックに格納されたバイトをファイルの内容であるかのように読み出せるようにする
ファイルが含まれている。IDEドライブを持つLinuxシステムには、/dev/hda、 /dev/hdc 、/dev/hdd というファイルがある。
これらのデバイスファイルは、/etc/passwd や /var/adm/utmpのような通常のデータファイルではない。
これらのデバイスファイルは、ディスクの生データへのアクセスを提供する。そして、cat、more,cp等のファイルコマンドを使えば、
ディスクの内容を読み出せる。utmpファイルと同様に、ディスクは明確な構造を持っている。たとえば、od -c /dev/hda | moreを使えば
ディスクの内容をブロックごとに解析することができる。コマンドの出力を見ていくと、ディスクブロックの連続シーケンスであるかのように
ディスクの内容を読むことができる。

各パーティションはこのようなスペシャルファイルの１つによって表現されている。
例えば、/dev/hdaの第１パーティションは、/dev/hda1という名前になっている。

では、/devディレクトリを探って、ハードディスク、フロッピーディスク、CD-ROM、その他のディスクドライブが
ディレクトリ内のどのスペシャルファイルに対応しているかを調べ、答えなさい。


## 自環境で確認
### 構成
ディスクはSSD１個しかついていなかったので、USBメモリを用意しPCに接続。
lsblkで確認する。
```
taichi84@DESKTOP-LFCUOR7:~/learning/unix_linux_programing/chapter4/question/4.02$ lsblk
NAME MAJ:MIN RM   SIZE RO TYPE MOUNTPOINTS
sda    8:0    0 388.4M  1 disk 
sdb    8:16   0   186M  1 disk 
sdc    8:32   0     4G  0 disk [SWAP]
sdd    8:48   0   256G  0 disk /var/lib/docker
                               /snap
                               /mnt/wslg/distro
                               /

```

パーティションごとに分かれているが、接続したUSBデバイスが見当たらない。

### wsl上での制限
通常のlinuxではUSBメモリなどを接続した瞬間にlsblkで確認できるが
wsl上ではwindows側でusbメモリをbindしてwslにattachしてやる必要がある。

powershellを管理者権限で開き、usbipd-win をインストール

```
winget install --interactive --exact dorssel.usbipd-win

```

usbipd listでBUSIDを確認

```
PS C:\WINDOWS\system32> usbipd list
Connected:
BUSID  VID:PID    DEVICE                                                        STATE
1-2    0930:6544  USB 大容量記憶装置                                            Not shared
1-3    1b3f:2008  USB Audio Device, USB 入力デバイス                            Not shared
1-11   26ce:01a2  USB 入力デバイス                                              Not shared
3-1    1a2c:4324  USB 入力デバイス                                              Not shared
3-2    18f8:1086  USB 入力デバイス                                              Not shared
3-3    0b95:7720  ASIX AX88772 USB2.0 to Fast Ethernet Adapter

```

対称デバイス（今回は1-2のUSB大容量記憶装置)をbindする。

```
usbipd bind --busid 1-2
```

WSLにアタッチ 

```
usbipd attach --wsl --busid 1-2
```

lsblkで確認すると

```
$ lsblk
NAME   MAJ:MIN RM   SIZE RO TYPE MOUNTPOINTS
sda      8:0    0 388.4M  1 disk 
sdb      8:16   0   186M  1 disk 
sdc      8:32   0     4G  0 disk [SWAP]
sdd      8:48   0   256G  0 disk /var/lib/docker
                                 /snap
                                 /mnt/wslg/distro
                                 /
sde      8:64   1   7.2G  0 disk 
└─sde1   8:65   1   7.2G  0 part 

```

sdeが追加されている。これが先ほど接続したusbメモリになる。

## 実際に内容を読めるか
``` 
$ sudo od -c /dev/sde1 

0000000 353   X 220   T   H   R   E   E   S          \0 002 020      \0
0000020 002  \0  \0  \0  \0 370  \0  \0   ?  \0      \0   ?  \0  \0  \0
0000040   !   < 347  \0 344 034  \0  \0  \0  \0  \0  \0 002  \0  \0  \0
0000060 001  \0 006  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0  \0
0000100  \0  \0   ) 365   L   j   v   T   O   S   H   I   B   A        
0000120           F   A   T   3   2             315 030 216 321 274 364
0000140   { 216 301 216 331 275  \0   | 210   N 002 212   V   @ 264  \b
0000160 315 023   s 005 271 377 377 212 361   f 017 266 306   @   f 017
0000200 266 321 200 342   ? 367 342 206 315 300 355 006   A   f 017 267
0000220 311   f 367 341   f 211   F 370 203   ~ 026  \0   u   8 203   ~
0000240   *  \0   w   2   f 213   F 034   f 203 300  \f 273  \0 200 271
0000260 001  \0 350   +  \0 351   H 003 240 372   } 264   } 213 360 254
0000300 204 300   t 027   < 377   t  \t 264 016 273  \a  \0 315 020 353
0000320 356 240 373   } 353 345 240 371   } 353 340 230 315 026 315 031
0000340   f   `   f   ;   F 370 017 202   J  \0   f   j  \0   f   P 006
0000360   S   f   h 020  \0 001  \0 200   ~ 002  \0 017 205      \0 264
0000400   A 273 252   U 212   V   @ 315 023 017 202 034  \0 201 373   U
0000420 252 017 205 024  \0 366 301 001 017 204  \r  \0 376   F 002 264
0000440   B 212   V   @ 213 364 315 023 260 371   f   X   f   X   f   X
0000460   f   X 353   *   f   3 322   f 017 267   N 030   f 367 361 376
0000500 302 212 312   f 213 320   f 301 352 020 367   v 032 206 326 212

~~ 続く ~~ 
```

読めているようだ。最初の法の決まったアドレスにFAT32などのフォーマットが表記されているので間違いないだろう。




## 検証作業
第４章の内容でmountをすることによって、ファイルシステムをディレクトリノードに追加できるとあった。
実際にmountでUSBのなかにファイルシステムを作ってディレクトリにマウントして、USBファイルに書き込むことはできるのか？

chatgptに確認

```
① 普通にファイルシステムをマウントして使う（一般的な方法）

USB メモリを刺す

デバイスを確認

lsblk


→ /dev/sdb1 みたいに出る

マウント

sudo mkdir /mnt/usb
sudo mount /dev/sdb1 /mnt/usb


コピーする

cp myfile.txt /mnt/usb/


終わったら

sync
sudo umount /mnt/usb


これは 一番安全で推奨 の方法です。
``` 

この操作でtouch test1 
vim で適当に内容を書いてtest2をUSBに書き込んだ後にumountしてUSBの中身を確認したら
test1 test2ファイルが無事に作成されていた。

この作業で確実にsdeが接続したUSBであることと、実際にmountをすることによって書き込み可能であることも確認できた。

## 結論
自分のシステムの場合
デフォルトのSSDデバイスはsda , sdb , sdc , sddにパーティションが切られた形で対応している。
接続したUSBメモリは、sdeでアクセス可能であることがわかった。(wsl環境だと色々下準備が必要)

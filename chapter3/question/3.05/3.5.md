# 研究課題3.5  
## 課題内容  
**実行可能な内容と実行可能なパーミッション** 全てのファイルは、オーナー、グループ、そのほか３種類の実行可能パーミッションビットを持っている。  
実行可能パーミッションは、文具店の買い物リストを格納する、プレーンテキストファイルを含め、全てのファイルにセットできる。  
一方、Cプログラムをコンパイルすると作成される、a.outのように、実行可能コードを格納するファイルでも、実行可能パーミッションはオフにできる。  
実行可能な内容と実行可能パーミッションの考え方の違いを説明しなさい。両者に関係はあるのか。  
fileコマンドのマニュアルを読んで考えること。  
  
## まずはいろいろファイル権限を操作し試す。  
実行可能ファイルから実行権限を外して実行しようとするとどうなるか。  
  
```  
  
$ ls -l ls1  
-rwxr-xr-x 1 taichi84 taichi84 16232 Aug  3 19:38 ls1  
  
$ chmod 444 ls1  
$ ls -l ls1  
-r--r--r-- 1 taichi84 taichi84 16232 Aug  3 19:38 ls1  
  
$ ./ls1  
bash: ./ls1: Permission denied  
  
```  
  
実行可能なファイルも当然実行権限を与えなければ実行できない。Permission deniedで弾かれる。  
  
  
ではただのソースコードに実行権限を付与するとどうなるか？  
  
```  
$ chmod 777 ls1.c   
$ ls -l ls1.c  
-rwxrwxrwx 1 taichi84 taichi84 880 Aug  3 19:38 ls1.c  
  
$ ./ls1.c  
./ls1.c: line 1: /bin: Is a directory  
./ls1.c: line 2: syntax error near unexpected token `('  
./ls1.c: line 2: ` *  目的 : ディレクトリ( 複数の場合も含む) の内容をリストアップする。'  
  
```  
  
ただのソースコードを無理やり実行しようとしたところ、ソースコードを１行ずつ実行しようとしているようだ。  
シェルがソースコードを解釈してそのまま実行しようとしているように見える。  
  
## 実行可能な内容と実行可能パーミッションの違い  
シェルはおそらく、実行可能な内容であろうとなかろうと、内容を読み込み解釈して実行しようとしている模様。  
実行可能パーミッションがある場合は、実行可能なものであれば、プログラムを実行し、  
実行可能でないならばシェル等が読みこんだときのエラーを返す。  
  
実行可能パーミッションはどんなものであれ、それをプログラムとして実行することを許可するかどうかを表すもの。  
実行可能なものも、そうではないものも、実行可能パーミッションがなければ、Permission deniedで実行せずに弾く。  
  
## fileのmanページを読む。  
ファイルの種類を特定するためのものらしい。  
- ファイルシステムテスト  
- マジックテスト  
- 言語テスト  
  
の３つの項目でテストしファイルの種類を特定する模様。  
  
### ファイルシステムテスト  
stat(2)による情報で空ファイルや特殊ファイルなどを判断する。  
  
### マジックテスト  
特定のバイナリ形式(ELF等)の「マジックナンバー」で判別。  
  
### 言語テスト  
テキストファイルの内容を見て、プログラミング言語やフォーマットを推測  
  
## 実際に何個か行ってみる。  
```  
$ file ls1  
ls1: ELF 64-bit LSB pie executable, x86-64, version 1 (SYSV), dynamically linked, interpreter /lib64/ld-linux-x86-64.so.2, BuildID[sha1]=766864d498423163f926628aa4c01b2451047b14, for GNU/Linux 3.2.0, not stripped  
  
$ file ls2.c  
ls2.c: C source, Unicode text, UTF-8 text  
  
$ file mode.md  
mode.md: Unicode text, UTF-8 text  
  
$ file 3.1.md  
3.1.md: C source, Unicode text, UTF-8 text  
  
$ file 3.2.md  
3.2.md: Unicode text, UTF-8 text  
  
```  
  
上から見ていこう。  
  
まずls1という実行ファイル。これはマジックテストまでで完全なバイナリファイルで実行形式はこれですよというのを特定できているようである。  
ls2.cはテキストファイル、Ｃのソースコードだと判断している。  
mode.mdはただのテキストファイルだよと判断している。  
  
次の内容は3.1.mdである。  
このマークダウンファイルで書かれたレポートの内容にはかなりの量、Ｃのsourceが含まれている。  
そのせいか、fileはCのsourceだと判断しているようだ。  
  
3.2.mdではやはりこちらはただのUnicodeのtextだと判断されており、Cのsourceだとは判断されていない。  
拡張子はファイルの判断基準にはなっていないようだ。  
  
## 結論  
実行可能なコードと実行可能なパーミッションについては両者に関係があるわけではなく、独立した作りになっている。  
あくまであらゆるファイルに対して実行可能許可がされているかどうかはパーミッションで判断。  
どういったファイルに対しても実行許可があり、./file　などで実行しようとしたらシェルはそれを解釈して実行しようとする。  
  
  
  

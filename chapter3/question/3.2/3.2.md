# 研究課題 3.2  
  
## 課題内容  
**自分からのファイル保護** chmod 007 filenameとすれば、パーミッションは------rwxとなる。  
間違ってはいないが変な感じがする。  
これでは、システムの全ての人にfilenameの読み出し、書き出し、実行を認めるが、ファイルのオーナーとグループのメンバーには認めないという意味になってしまう。  
ファイルにこのモードを設定しなさい。  
オーナーはこのファイルを読めるかどうかを答えなさい。  
パーミッションを様々に組み合わせて試し、openシステムコールにファイルへのアクセスを認めるかどうかを決めるときにカーネルが使っているロジックを突き止めなさい。  
カーネルのソースがみられる場合には、パーミッションの内容を実施するコードを探し、自分の推測が正しかったかどうか確かめなさい。  
  
## chmod 007を適当なファイルに適用し、中身をcat出来るか確認する。  
  
実際にtest用の空ファイルを作成してみる。  
  
```  
  
$ touch testfile  
$ ls -l testfile  
-rw-r--r-- 1 taichi84 taichi84 0 Aug 10 15:26 testfile  
  
$ chmod 007 testfile  
$ ls -l testfile  
-------rwx 1 taichi84 taichi84 0 Aug 10 15:26 testfile  
  
$ cat testfile  
cat: testfile: Permission denied  
  
```  
  
Permission deniedで弾かれてしまう。その他のユーザーが利用できる状態でも、ユーザーの利用が許されていなければ自分のファイルであってもアクセスはできないようだ。  
  
## groupを070にした場合はどうか?  
```  
  
taichi84@DESKTOP-LFCUOR7:~/unix_linux_programing/chapter3/question$ id  
uid=1000(taichi84) gid=1000(taichi84) groups=1000(taichi84),4(adm),20(dialout),24(cdrom),25(floppy),27(sudo),29(audio),30(dip),44(video),46(plugdev),116(netdev)  
  
taichi84@DESKTOP-LFCUOR7:~/unix_linux_programing/chapter3/question$ touch testfile  
taichi84@DESKTOP-LFCUOR7:~/unix_linux_programing/chapter3/question$ ls -l testfile  
-rw-r--r-- 1 taichi84 taichi84 0 Aug 10 15:31 testfile  
taichi84@DESKTOP-LFCUOR7:~/unix_linux_programing/chapter3/question$ chmod 070 testfile  
taichi84@DESKTOP-LFCUOR7:~/unix_linux_programing/chapter3/question$ ls -l testfile  
----rwx--- 1 taichi84 taichi84 0 Aug 10 15:31 testfile  
taichi84@DESKTOP-LFCUOR7:~/unix_linux_programing/chapter3/question$ cat testfile  
cat: testfile: Permission denied  
  
```  
  
taichi84はtaichi84 groupに所属しているのにも関わらず、ユーザーの読み取り権限がないので、弾かれてしまう。  
例えば 070 にしているときにユーザーかつグループの人は見れないが、グループに所属しているだけの人は見れるという逆転現象が起こる。  
## 上記二つの事柄から推測されるロジック  
  
パーミッションを判定し、該当の条件を満たさなければPermission Deniedで弾くという処理をしていると思われる。  
一見、その他はGroupを内包し、Groupはユーザーを内包しているように思えるが、これはそうではない。  
その他もGroupも独立したものになっている。  
  
その上でカーネルは今要求してきたプロセスはどういうプロセスなのか？を以下のように判定している。  
  
```  
if(プロセスはユーザーの場合)  
{  
    if(ファイルはユーザー空のアクセスを許可してない場合)  
   {  
        printf(permission denied);  
        exit  
    }  
}  
else if(プロセスはグループの場合)  
{  
    if(ファイルはグループからのアクセスを許可してない場合)  
    {  
        printf(permission denied);  
        exit  
    }  
}  
else  
{  
    if(ファイルはその他からのアクセスを許可してない場合)  
    {  
        printf(permission denied);  
        exit  
    }  
  
  
}  
  
```  
  
このような順番で処理した場合、ユーザーかどうかを確認した後にすぐ弾かれてしまうので、ユーザーかつグループのプロセスは最初に弾かれてしまい、グループが一致しているかどうかは判定されない。  
グループのユーザーは上の処理を飛ばすので、グループのユーザーかどうかで判定される。その他のユーザーはユーザーの処理とグループの場合の処理を飛ばすので閲覧が可能というようになっている。  
  
  

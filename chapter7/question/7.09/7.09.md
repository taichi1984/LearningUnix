# プログラミング課題7.9
## 課題内容
**電光ニュース表示** cursesを使ってファイルの内容を電光ニュース風に表示するプログラムを書きなさい。
電光ニュース風の表示（マーキー、チッカーテープ表示）とは、テキストを表示する横長の領域で文字が画面を横切ってスクロールしていくものである。
プログラムはコマンド行でファイル名、長さ、位置、表示速度を受け付けるものにしなさい。

## ソースコード

```

#include <assert.h>
#include <curses.h>
#include <fcntl.h>
#include <iso646.h>
#include <signal.h>
#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include <sys/time.h>
#include <unistd.h>

int x;
int set_ticker(int);
void move_str(int);

int main(int ac, char *av[]) {
  if (ac != 5) {
    fprintf(stderr, "usage: %s file length position speed \n", av[0]);
    exit(1);
  }

  char *end;

  int length = strtol(av[2], &end, 10);
  int position = strtol(av[3], &end, 10);
  int speed = strtol(av[4], &end, 10);

  char buf[length + 1];
  char erace[length + 1];

  memset(erace, ' ', length);
  erace[length] = '\0';
  int fd;

  fd = open(av[1], O_RDONLY);
  if (fd == -1) {
    perror("open");
    exit(2);
  }

  int len = read(fd, buf, length);

  close(fd);

  if (len < 0) {
    perror("read");
    exit(3);
  }

  for (int i = 0; i <= length; i++) {
    if (buf[i] == '\n')
      buf[i] = ' ';
  }

  initscr();
  clear();
  noecho();
  x = COLS - 1;

  signal(SIGALRM, move_str);
  set_ticker(100);

  while (1) {
    int start = 0;
    int count = len;
    int screen_x = x;

    // 左にはみ出し
    if (screen_x < 0) {
      start = -screen_x;
      count = len - start;
      screen_x = 0;
    }
    // 右にはみだし
    if (screen_x + count > COLS) {
      count = COLS - screen_x;
    }

    if (count > 0) {
      mvaddnstr(position, screen_x, buf + start, count);
    }
    refresh();

    pause();

    start = 0;
    count = len;
    screen_x = x;

    if (screen_x < 0) {
      start = -screen_x;
      count = len - start;
      screen_x = 0;
    }
    if (screen_x + count > COLS) {
      count = COLS - screen_x;
    }

    if (count > 0) {
      mvaddnstr(position, screen_x, erace + start, count);
    }

    // 左端に消え去ったら右端に戻す
    if (x < -len)
      x = COLS;
  }

  endwin();
}

int set_ticker(int n_msecs) {
  struct itimerval new_timeset;
  long n_sec, n_usecs;

  n_sec = n_msecs / 1000;
  n_usecs = (n_msecs % 1000) * 1000L;

  new_timeset.it_interval.tv_sec = n_sec;
  new_timeset.it_interval.tv_usec = n_usecs;

  new_timeset.it_value.tv_sec = n_sec;
  new_timeset.it_value.tv_usec = n_usecs;

  return setitimer(ITIMER_REAL, &new_timeset, NULL);
}

void move_str(int signum) { x--; }

``` 



# 研究課題 4.17  
## 課題内容  
本文では、linkとunlinkを使って、renameの一種を書いた。このコード片では、linkの戻り値はチェックされていたが  
unlinkの戻り値はチェックされていなかった。  
unlinkのエラーを正しく処理するようにこのコードを拡張しなさい。  
  
## 本文のlinkとunlinkってどれ？  
```  
if( link("x","z") !=-1)  
unlink("x");  
```  
  
多分このコード。  
linkが成功したらハードリンクが作成されるので、元のリンクを削除することによってrenameと同じ動作を実現している。  
  
## エラー処理するならこんな感じ。   
わかりずらいため、下のコードのxとyをfrom toに書き換えて処理を書く  
```  
if( link("x","z") !=-1)  
unlink("x");  
```  
  
```  
  if (link(from, to) != -1) {  
    if (unlink(from) == -1) {  
      perror("unlink from");  
        
      if(unlink(to) == -1){  
        perror("unlink to rollback");  
      }  
  
      return -1;  
    }  
  } else {  
    perror("link");  
    return -1;  
  }  
```  
  
unlinkが失敗した場合、linkで作成したto側のリンクをunlinkで削除しておくのが大事。  
これがエラーになった場合は、どうすればいいか難しいけど、基本ならないはず。  

# 研究課題2.1  
  
## 課題文  
　w コマンド　Unixは、whoと関係のあるwというコマンドを持っている。このコマンドを試して,  
  manページを読みなさい。  
　  
  - whoが提供せず wが提供している情報はどのようなものか？  
  - その情報の中のどれだけの部分がutmpファイルに含まれているのか?  
  - 他の情報は何を意味しているか?  
  - 他の情報の供給源はどこにあるのか？  
  
  これらの問いに答えなさい。  
  
  
## whoが提供せず wが提供している情報はどのようなものか？  
  
whoが提供しているものは、ユーザー名、端末の種類、ログイン時刻の３つ。  
  
wを実際に使ってみるとどうなるのか  
  
```  
$ w  
  
  
19:41:00 up  4:09,  1 user,  load average: 0.00, 0.00, 0.00  
USER     TTY      FROM             LOGIN@   IDLE   JCPU   PCPU WHAT  
taichi84 pts/1    -                15:04    4:36m  0.02s  0.02s -bash  
  
  
```  
### 1行目  
まず１行目は以下のような内容になっている。  
```  
19:41:00 up  4:09,  1 user,  load average: 0.00, 0.00, 0.00  
│       │    │       │         │  
│       │    │       │         └→ 過去 15 分間の平均負荷（load average）  
│       │    │       └→ ログイン中のユーザー数  
│       │    └→ システムが稼働してからの経過時間（uptime）  
│       └→ "up"：uptime表示が始まるキーワード  
└→ 現在の時刻（システムクロック）  
```  
  
load averageは過去１５分間の平均不可だが、左から過去１分間、５分間、１５分間と３段階で表示されるようになっている  
0.00の場合、ほぼアイドル状態に近いということになる。  
ざっくりいうと、マシンの健康状態を見れると思っていい。  
  
### 2行目以降  
２行目の内容は３行目以降の内容のヘッダになっている。  
USER , TTY , FROM , LOGIN@ , IDLE , JCPU , PCPU , WHATの項目がある。  
  
３行目以降はレコード。２行目のヘッダの順にデータが書かれている。  
  
| フィールド    | 説明                                                  |
| -------- | --------------------------------------------------- |
| `USER`   | ログインしているユーザー名（例：`nishimo`）                          |
| `TTY`    | どの端末（仮想端末）からログインしているか（例：`pts/0` は pseudoterminal 0） |
| `FROM`   | リモート接続元のホスト名またはIP（ローカルなら `-` や空欄）                   |
| `LOGIN@` | ユーザーがログインした時刻（いつそのセッションを開始したか）                      |
| `IDLE`   | その端末で最後にキー入力や出力があった時からの経過時間（「放置時間」）                 |
| `JCPU`   | その TTY 上で動いていた全プロセスの合計 CPU 時間（ジョブ全体の合計）             |
| `PCPU`   | 現在実行中のプロセス（WHAT列）の CPU 使用時間（そのプロセス単体の消費時間）          |
| `WHAT`   | 今そのユーザーが実行中のコマンド（プロセス名、たとえば `bash` や `vim` など）      |
  
### wが提供していてwhoが提供していないもの  
IDLE  
JCPU  
PCPU  
WHAT  
  
あたりの内容は提供されていない。  
  
## その情報の中のどれだけの部分がutmpファイルに含まれているのか？  
USER,TTY,FROM,LOGINはUTMPファイルに含まれている。-  
  
  
  
## 他の情報は何を意味しているか?  
上記の表にあるJCPUやPCPUやWHATの内容の通り。  
  
  
## 他の情報の供給源はどこにあるのか？  
### IDLEについて  
IDLEの情報はwコマンドが端末ファイルの最終アクセス時刻をstat()して取得している。  
IDLEの供給源は/dev/[tty名]の最終アクセス時刻になる。  
  
### その他の情報について  
  
/procにある  
procには各プロセスの情報が含まれている。  
カーネルは各プロセスが何かの行動をとったらプロセスに関する情報を書き換える。  
  
JCPU, PCPU：/proc/[pid]/stat（CPU時間情報）  
WHAT：/proc/[pid]/cmdline（実行コマンドライン）  
  
  

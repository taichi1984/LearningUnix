# 研究課題7.1
## 課題内容
pauseは、SIGINTなど、キーボードから生成されるシグナルを含め、あらゆるシグナルが届くのを待つ。
(a) sleep1を実行して、Ctrl+Cを押すとどうなるか、それはなぜか。
(b) SIGINTを処理できるようにsleep1を書き換えなさい。
(c) 新しいプログラムを実行してCtrl+Cを押すとどうなるか。それはなぜか。

## sleep1.cについて

### ソースコード
```
/* sleep1.c
 * 目的:sleepの仕組みを示す。
 * 使い方 : sleep1
 * 概要: ハンドラを設定し、alarm() , pause（）を呼び出して再び目を覚ます。
 */

#include <signal.h>
#include <stdio.h>
#include <unistd.h>

// #define SHHHH

int main() {
  void wakeup(int);

  printf("about to sleep for 4seconds\n");
  signal(SIGALRM, wakeup);
  alarm(4);
  pause();
  printf("Morning so soon? \n");
}

void wakeup(int signum) {
#ifndef SHHHH
  printf("Alarm received from kernel\n");
#endif
}


```
### 実行結果
```
$ ./sleep1
about to sleep for 4seconds
// 4秒経過
Alarm received from kernel
Morning so soon? 
```

このようなプログラムである。

## (a)sleep1を実行してCtrl+Cを押すとどうなるか。

```
$ ./sleep1
about to sleep for 4seconds
^C
```

CTRL+Cが押された時点でプログラムは終了する。
これはsignalの一種であるSIGINTによる割り込みをハンドリングしていないため。
SIGINTはハンドリングされていない場合のデフォルトの動きはterminateなので、
割り込みが起これば、プロセスは終了される。

## (b) SIGINTを処理できるようにsleep1を書き換えなさい。(c)それを実行してCTRL＋Cで割り込むとどうなるか。それはなぜか。

### ソースコード

```
/* sleep2.c
 * 目的:sleepの仕組みを示す。
 * 使い方 : sleep1
 * 概要: ハンドラを設定し、alarm() , pause（）を呼び出して再び目を覚ます。
 * CTRL+CでSIGINTで割り込んだ場合は、\nDetect SIGINT\nと表示する。
 */

#include <signal.h>
#include <stdio.h>
#include <string.h>
#include <unistd.h>

// #define SHHHH

int main() {
  void wakeup(int);
  void detect_sigint(int);

  printf("about to sleep for 4seconds\n");
  signal(SIGALRM, wakeup);
  signal(SIGINT, detect_sigint);
  alarm(4);
  pause();
  printf("Morning so soon? \n");
}

void wakeup(int signum) {
#ifndef SHHHH
  printf("Alarm received from kernel\n");
#endif
}

void detect_sigint(int signum) {
  int r =
      write(STDOUT_FILENO, "\nDetect SIGINT \n", strlen("\nDetect SIGINT \n"));
}
```

### 実行結果

```
$ ./sleep2
about to sleep for 4seconds
^C  // CTRL+Cを押す
Detect SIGINT 
Morning so soon? 
```

SIGINTを上手くハンドルして処理できた。

### なぜSIGINTを処理できたのか。
signal(SIGINT,detect_sigint) で、SIGINTが来たときの対応をプロセスに指定することができる。
第２引数にはデフォルト動作、無視（SIG_IGN)、ハンドルするための関数を指定できる。
今回は関数を指定し、SIGINTがきたら、"\nDetect SIGINT\n"を表示するようにプログラムを書いたため、上記のような動作になる。
pause()関数は何らかのシグナルがくるまで、スレッドを止めておく関数なので、SIGINTが来た時点でpauseは解除され、次の処理に移行するため、"Morning so soon?"が表示される。



# 研究課題4.5
## 課題内容
Unixは、PC-DOS、Macintoshディスクなど、Unix以外のファイルシステムを含むディスクをマウントし、読み出すことができる。
しかし、これらのシステムはinodeを持っていない。にもかかわらず、mountコマンドを使ってこれらのディスクをUnixシステムに接続すると、
ls -lコマンドはinodeを出力するようになる。
Linuxのソースコードを探り、これらの数値がどこから与えられるのかを調べなさい。
Linuxは、そのあとで何を加えているのかも説明しなさい。

## lsはどうやってinodeを生成するのか？
lsはinodeを生成しない。lsで使うstatシステムコールはあくまでinodeを参照だけしており、生成の作業は行っていない。
生成は別のカーネルの機能が行っている。

### fs/inode.cを確認する。
inode.cでnew_inode(struct super_block *sb)関数を確認する。
これでスーパーブロックの情報をもとにinodeを作成しているようだ。
inodeの実際の作成はalloc_inode(sb)がスーパーブロックの情報で確保してくるようだ。

### もともとinodeのないファイルシステムにlinuxはどうやって割り当てているのか？
mount時に使うmountシステムコールでは、まずそのファイルシステムに対応するスーパーブロックが読み込まれる。
その後、ルートディレクトリのdentry+inodeが少なくとも一つは作られる。

unix系のファイルシステムではないファイルシステムにもディレクトリエントリにはファイル名とディスク上の物理ブロック番号が入っている。
VFS(Virtual File System 、Unixのファイルシステム)はその情報をもとにこのファイルを現すinodeがないと判断したらinodeを作成する。
つまり、最初にもともとのファイルシステムのファイル名とディスク上の物理ブロック番号でファイルを参照したら、そのタイミングでinodeがない場合はinodeを割り当て
そこからはinodeで判断してunixの文脈でファイルを扱えるようにしている。


## 問いに対する答え
### inodeの数値はどこから与えられるのか？
inodeを持たないファイルシステムではVFSがinode番号を割り当てる。

### linuxはそのあとで何を加えているか。
inode番号に加えて,mode,uid,gid.nlink,size,timstampsなどを埋め込んでstat構造体として返せるようにしている。



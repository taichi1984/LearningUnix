/****************************************************************************

第３章で学ぶコマンド

*****************************************************************************/ 

# ls  

## 概要  

ディレクトリにあるコンテンツをリストアップするコマンド。  
各種オプションにより、.ではじまる隠しファイルを表示したり、リストアップしたファイルに関する情報も表示できる。  

## 形式  
ls [OPTION] ... [FILE] ...  

FILEはディレクトリ指定可能。ディレクトリを指定した場合は、ディレクトリにあるファイル全てを表示する。  
省略した場合は、カレントディレクトリにあるファイルをリストアップする。  

## よく使われるコマンド行オプション一覧  

|コマンド|動作|
|:------|:----|
|ls -a| ファイル名の先頭が"."になっているファイルも表示する。|
|ls -lu| 最後に読みだした日時を表示する。|
|ls -s|サイズをブロック単位で表示する。|
|ls -t|時刻順にソートする。|
|ls -F|ファイルタイプを表示する。|

# ls -lについて  
ls -lをこのディレクトリで行った結果は以下のようになる。   

```  
total 32  
-rw-r--r-- 1 taichi84 taichi84   996 Aug  3 18:54 command.md  
-rwxr-xr-x 1 taichi84 taichi84 16232 Aug  3 19:38 ls1  
-rw-r--r-- 1 taichi84 taichi84   880 Aug  3 19:38 ls1.c  
-rw-r--r-- 1 taichi84 taichi84   400 Aug  3 19:26 myls1.c  
-rw-r--r-- 1 taichi84 taichi84  3475 Aug  3 21:01 systemcall.md  
```  

各行は7つのフィールドから構成されている。  
total 32の部分は、このファイル群が使っているファイルブロック数(1ブロック512byte)になります。  

## モード  
 各行の最初の-rw-r--r--などの文字は、モードという。  
最初の文字はファイルタイプを表している。  
残りの9文字はパーミッションである。  

### ファイルタイプについて  
ファイルタイプは以下の通り  


| 文字  | 意味            | 説明例                       |
| --- | ------------- | ------------------------- |
| `-` | 通常ファイル        | テキストファイルや実行ファイルなど         |
| `d` | ディレクトリ        | フォルダ                      |
| `l` | シンボリックリンク     | 別ファイルやディレクトリへの参照          |
| `c` | キャラクタデバイス     | `/dev/null` など、1文字単位のデバイス |
| `b` | ブロックデバイス      | `/dev/sda` など、ブロック単位のデバイス |
| `p` | 名前付きパイプ（FIFO） | プロセス間通信用の特殊ファイル           |
| `s` | ソケット          | UNIXドメインソケットなど            |
| `D` | ドア（Solarisのみ） | Solaris特有のIPCメカニズム        |


ファイルがどんな種類のものであるのかを確認できる。  

この１文字だけで、stat()システムコールのst_modeのファイル種別がわかる。  


### パーミッションについて  
permission（パーミッション)とはアクセス許可情報のこと。  
ファイルの読み出し、書き込み、実行の３種類の許可がユーザー、グループ、その他のユーザーの３種類の分類ごとに設定できる。  

**例1**  
```  
-rw-r--r-- 1 taichi84 taichi84   996 Aug  3 18:54 command.md  
```  
左からファイルのオーナー、ファイルのグループに属してるユーザー、その他のユーザーのパーミッションになっている。  
ファイルのオーナーはrw-なので読み込みと書き込みが可能、グループに属しているユーザーとその他のユーザーのパーミッションはr--なので読み出しだけ可能になっている。  

**例2**  
```  
-rwxr-xr-x 1 taichi84 taichi84 16232 Aug  3 19:38 ls1  
```  

こちらはls1の実行ファイル。  
ファイルのオーナーはrwxなので、読み書き実行が可能、グループに属しているユーザーとその他のユーザーのパーミッションはr-xなので読み出しと実行のみ可能となっている。  

## リンク  
２個目の項目の数値。リンクとはファイルに対する参照の数である。  
シンボリックリンクではなく、ハードリンク数である。通常ファイルなら１（自分自身にたいして)、ハードリンクがあるファイルやディレクトリは２以上になる。  
詳細に関しては次章にて。  

## オーナー  
全てのファイルはあるユーザーに属している。上の例ではtaichi84がオーナーってことになる。  

## グループ  
全てのファイルは、ユーザーのグループにも属している。一部バージョンのlsは、グループ名を表示する。  
このubuntuでは表示されている。  
このユーザーのグループはファイルを作成したユーザーがその時所属していたグループが自動で割り当てられるが  
オーナーユーザーが変わったとしてもグループは変わらず、変更したい場合は明示的に変更する必要がある。  

## サイズ  
ファイルに含まれているバイト数が表示される。  
ディレクトリのサイズは常にブロック単位で割り当てられるので、ディレクトリのサイズは常に1ブロックごとの単位に分けられている。  
ちなみに自分の今のubuntu環境上では、実際の１ブロックは4096バイトになっているので、4096と表示されている。  

## 最終変更日時  
日付と時間は最終変更日時である。月、日、時刻が含まれる。  
古いファイルに関しては月、日、年を表示する。  

## 名前  
最後に、ファイルの名前を出力する。  


# chmod
ファイルやディレクトリのパーミッションを変更するコマンド

## 形式
chmod [オプション] モード ファイル名

## モードのパターン

| 数値  | 説明            |
| --- | ------------- |
| `7` | 読み・書き・実行（rwx） |
| `6` | 読み・書き（rw-）    |
| `5` | 読み・実行（r-x）    |
| `4` | 読み（r--）       |
| `0` | 何もなし（---）     |

３桁でユーザー、グループ、その他に対応している。

## 基本的な使用例

$ chmod 755 filename

所有者:rwx
グループ:r-x
その他 : r-x

という感じに変更される。

## 記号式での設定例

$ chmod u+x filename // userに実効権限を与える

$ chmod g-w filename // groupから書き込み権を削除

| 対象  | 説明          |
| --- | ----------- |
| `u` | 所有者（user）   |
| `g` | グループ（group） |
| `o` | その他（others） |
| `a` | 全員（all）     |


| 演算子 | 意味       |
| --- | -------- |
| `+` | 権限を追加    |
| `-` | 権限を削除    |
| `=` | 権限を上書きする |

## 特殊ビットの設定
modeを４桁にすることで特殊ビットの設定が可能。
上位の１桁が特殊ビットになる。

- 4 → suid
- 2 → sgid
- 1 → sticky

## ディレクトリに使う時

$ chmod -R 755 mydir 

-R オプションを付けることで再帰的に変更可能（ディレクトリ内の全てのファイル、フォルダに適用可能)

# chownコマンド
ファイルのユーザーを変更する。

## 形式
chown [ユーザー] filename
chown [ユーザー]:[グループ] filename

通常のユーザーは自分以外の所有者に変更ができない(任意に変えたい場合はroot権限要)

# chgrp コマンド
ファイルやディレクトリのグループだけを変更する

## 形式
chgrp [グループ名] ファイル

# touch コマンド
ファイルのタイムスタンプを更新する。

touch [オプション] filename

filenameが存在しない場合は、その名前の空のファイルを作成します。
存在する場合はアクセス時刻と、修正時刻が更新されます。





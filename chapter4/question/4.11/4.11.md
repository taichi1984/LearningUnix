# 研究課題4.11  
## 課題内容  
シリンダという用語はハードディスクの何を意味するのか。  
シリンダ概念がディスクの効率的な利用のために重要な意味を持つのは、ハードディスクの構造のどの部分と関係しているのか。  
Webでシリンダグループという単語を検索し、この考え方と本文で説明したファイルシステムのモデルとの関係を説明しなさい。  
  
## シリンダとは何か？  
HDDはプラッタというディスクのような円盤状のデータを保存する媒体が何枚も重なってできている。  
その重なっている各プラッタの同じ位置を上から下に切り取った形状のデータの集まりをシリンダと呼ぶ。  
  
```  
 ---------------===----  
  
 ---------------===----  
  
 ---------------===----  
  
 ---------------===----  
  
```  
  
各線が横から見たプラッタの絵としてみた場合、同じ位置が===になっている。  
この縦の部分に並んだものがシリンダである。  
  
## プラッタの内容はヘッドが読む  
プラッタの内容はヘッドが読むが、このヘッドは全てのプラッタに２個ずつ用意されているが、  
ヘッド自体は全てのヘッドが各プラッタの同じ位置を読む構造になっている。  
  
  
```  
               [H] -------|
---------------===----    |
               [H] -------|
               [H] -------|
---------------===----    |
               [H] -------|
               [H] -------|
---------------===----    |
               [H] -------|
               [H] -------|
---------------===----    |
               [H] -------|
                          |
                          |
[H]は各プラッタに対応したヘッド、表と裏から読む。  
こんな感じでヘッドがついている部品は各プラッタの同じ位置を読めるように作られている。  
  
```  
  
このため、シリンダが同じであれば、ヘッドの位置は変更する必要がなく、各プラッタの回転と読み取るヘッドを切り替えるだけでいいが  
シリンダが別の場合はヘッドの位置をずらすためにシークしなければならない。  
これがシリンダグループが非常に大事で、効率的な利用のために大きく影響する理由である。  
同一ファイルの内容ならば、同じシリンダグループにあったほうが、読み込みが早くなる。  
  
## UNIXのファイルシステムとの関係  
UNIXのFFS(Fast File System)は「Cylinder Group」という単位を導入し  
- スーパーブロックのコピー  
- inodeテーブル  
- データグロック  
  
を１グループ内にまとめるという工夫を行っている。これにより、シークの回数を最小限に減らし、素早いディスク読み取りを実現している。  
  
linuxのext 2/3/4 のブロックグループも同じ思想で作られている。  
  
シリンダグループは複数のシリンダをまとめた論理的単位であり、シリンダそのものではないことに注意。  
  
  
  
## SSDはどうなっているのか？  
SSDはフラッシュメモリセルの集合のため、HDDとは構造が違うので当然シリンダグループなどの最適化は意味がない。  
簡単にChatGPTで調べた内容をそのまま書き記しておく。  
  
### 1. SSDの物理構造と制約  
  
SSDはフラッシュメモリセルの集合。  
  
データは「ページ（数KB単位）」に書き込まれ、消去は「ブロック（数百KB〜数MB単位）」でまとめて行う。  
  
読み出しは速いが、「上書き」ができないため、書き込み・消去の最適化が重要。  
  
### 2. SSD特有の最適化技術  
1. ウェアレベリング（Wear Leveling）  
  
特定のセルだけが繰り返し書き換えられて劣化しないように、  
書き込みを均等に分散する仕組み。  
  
OSから見れば同じアドレスでも、実際にはフラッシュ上で場所がどんどん入れ替わる。  
  
2. ガーベジコレクション（GC）  
  
消去単位（ブロック）と書き込み単位（ページ）が違うため、使い終わった領域をまとめて整理する処理。  
  
HDDでいう「デフラグ」に似ているが、目的は空きブロックの確保。  
  
3. TRIMコマンド  
  
OSが「この領域はもう使ってないよ」とSSDに通知して、ガーベジコレクションを効率化する仕組み。  
  
4. 並列アクセス（チャネル／ダイ）  
  
SSD内部には複数のフラッシュチップやダイがあり、  
RAIDのように並列で読み書きすることで大幅な速度を実現している。  
  
HDDの「シリンダグループにまとめて効率化」とは発想が逆で、分散させて並列化して速くしている。  
  
### 3. ファイルシステム側の工夫  
  
ext4やXFSなど従来のFSもそのまま使えるが、SSD向けには「不要なシーク削減」ではなく  
書き込み回数を減らす・連続領域をなるべく使うことが重要。  
  
そのため、最近は F2FS (Flash-Friendly File System) のように、  
フラッシュの特性（ページ書き込み／ブロック消去）に合わせた設計のFSも登場している。  

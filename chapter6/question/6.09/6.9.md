# プログラミング課題
## 課題内容
プログラムは、signalシステムコールを呼び出して、SIGINT、SIGQUITなど、特定シグナルを無視するように
システムに要求することができるが、最初からこれらのシグナルが生成されないようにするという戦略もある。
端末ドライバはISIGというフラグを持っている。マニュアルページを呼んで、このフラグは何をするものなのかを調べなさい。
そして、sigdemo2.cを書き換えて、このフラグを使うようにしなさい。
書き換えたあとのプログラムは、キーボード以外のどこかからSIGINTを受け取ったときに何をするか。
killコマンドについて学習し、killを使ってISIGオフバージョンにSIGINTを送って確かめなさい。


## ISIGフラグは何をするものなのか？
termiosのmanページによると
```
ISIG   INTR, QUIT, SUSP, DSUSP の文字を受信した時、対応するシグナルを 発生させる。
```
となっている。
端末はデフォルトではISIGはオンになっているため、解除してみよう。

### プログラム
```

#include <alloca.h>
#include <signal.h>
#include <stdio.h>
#include <stdlib.h>
#include <termios.h>
#include <unistd.h>

void set_isig_off();

int main() {
  void f(int);
  int i;
  set_isig_off();

  signal(SIGINT, f);
  for (i = 0; i < 20; i++) {
    printf("hello\n");
    sleep(1);
  }
  return 0;
}

void set_isig_off() {
  struct termios ttystate;

  tcgetattr(0, &ttystate);
  ttystate.c_lflag &= ~ISIG;
  tcsetattr(0, TCSANOW, &ttystate);
}

void f(int signum) {

  int c;
  printf("    Interrupted! OK to Quit(y/n)?");
  c = getchar();

  if (c == 'y' || c == 'Y') {
    exit(2);
  }
}
```

### 実行結果

```

hello
hello
^C^C^Chello
hello
^Z^Z^Zhello

^\hello
^\^\^\hello
hello
hello
hello
以下略
```

各種シグナルを送っても反応しなくなった。

## killコマンドでシグナルを送る
プロセス実行中にkillコマンドでSIGINTを実行中のコマンドに送ったところ、端末設定のISIGはオフになっているにも関わらず、
シグナル自体の送信は可能だった。SIGKILLやSIGTERMでプロセスを止めることもできれば、SIGINTでプロンプトを表示させることも出来た。

これはどういうことなのか？

### キーボードからの入力時にシグナルを発生させているのは、端末ドライバである。
キーボードからCTRL+Cなどのシグナルを発生させるキーストロークが入力された場合、端末ドライバはOSに対してプロセスにシグナルで割り込むように要求する。
これを受けてOSはプロセスに対してSIGNALで割り込んでいくようになっている。

ISIGフラグはキーストロークを受けたときに端末がOSに対してプロセスに対してシグナルで割り込みを要求するか？のフラグである。
**受けたシグナルをプロセスが無視するかどうかのフラグではない**

他の端末などからの特定のプロセスに対してkillコマンドでシグナルによる割り込みを要求した場合、OSはそのプロセスにシグナルで割り込みを行う。
ISIGフラグがオフになっている場合も、その端末上で動いているプロセスはシグナルを受け取るようになっている。



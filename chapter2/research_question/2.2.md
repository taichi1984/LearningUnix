# 研究課題2.2  
  
## 課題  
  
クラッシュとutmp  ログインすると、ユーザー名、端末回線、時刻、リモートホストがutmpファイルに記録される。  
ログアウトすると、レコードはクリアされる。では、システムがクラッシュするとどうなるか？  
当然ながら、utmpファイルには、クラッシュしたときにログインしていたユーザーのリストが残されている。  
システムが再び実行されたときにutmpファイルに含まれている情報は正確ではない。Unixは、システムの起動時にutmpファイルをどうするだろうか？  
利用可能な全ての端末回線のためのエントリに基づいてutmpファイルを作成するのか、空ファイルを作って端末回線エントリが少しずつ増えていくのを認めるのか  
マニュアル、ヘッダファイル、起動スクリプトを検索して、この問いに対する答えを探しなさい。自分のマシンで試してみることができるはずだ。  
  
## 予想  
起動前は絶対に接続している人がいないはずなので、起動毎にutmpファイルを作り直して、  
端末の接続を待てば問題ないはず。自分ならこの形にとりあえずする。  
  
## utmpのmanページにある記載(chatGPTによる翻訳)  
```  
最初に作成されるエントリは、init(1) が inittab(5) を処理することによって生成される。  
ただし、エントリが処理される前に、init(1) は utmp のクリーンアップを行う。具体的には、  
ut_type が DEAD_PROCESS または RUN_LVL 以外であり、かつ ut_pid に対応するプロセスが存在しないレコードについて、以下のように処理を行う：  
  
ut_type を DEAD_PROCESS に設定する  
  
ut_user、ut_host、ut_time をヌルバイト（null bytes）でクリアする  
  
そのうえで、必要な ut_id を持つ空のレコードが見つからない場合は、init(1) は新しいレコードを作成する。  
そして：  
  
ut_id を inittab から取得した値に設定し、  
  
ut_pid と ut_time を現在の値に設定し、  
  
ut_type を INIT_PROCESS に設定する。  
  
```  
  
utmpファイル自体は作り直さないが、もう使っていないプロセスのut_typeをDEAD_PROCESSにする。  
その上で、そのレコードの内容をnull bytesでクリアする。  
そこから新たにレコードを作っていく。  
  
死んだセッションの跡地に関しては再利用していく。  
